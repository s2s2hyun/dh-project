---
title: 'Nextjs NextAuth 라이브러리 소셜로그인'
description: 'NextAuth를 통한 간편한 소셜로그인 '
image: '../../public/blogs/logo/nextjs-logo.png'
publishedAt: '2023-01-01'
updatedAt: '2023-01-01'
author: 'DH'
isPublished: true
tags:
  - Next.JS
---

Next-auth는 Next.js 프로젝트에서 소셜 로그인을 간단하게 구현할 수 있는 라이브러리 입니다.

국내에서는 구글, 카카오, 네이버, 페이스북, 애플 등 다양한 소셜 로그인을 이용하고 사용중입니다.

해당 사이트가 늘어나면 늘어날 수록 로직은 다양해지고 , 각 회사별 프로젝트내 소셜로그인을 통한 정보를 수집하는 경우도 다를것 입니다.

이번 블로그 게시글은 next-auth 라이브러리를 이용해 한번에 쉽고 간단하게 구현하는걸 공부해보겠습니다.

## 1. Next.js 프로젝트 구성

Typescript,tailwind,App Router 방식을 이용해서 구현할 예정입니다.

1. npx create-next-app 을 통해서 nextjs 프로젝트를 설치해줍니다. (설치는 생략하겠습니다.)

2. [NextAuth](https://next-auth.js.org/getting-started/example) 라이브러리 홈페이지에 접속하면 각 패키지에 맞게 설치를 진행해주시면됩니다.

3. app/api/auth/[...nextauth]/route.ts

```tsx
import NextAuth from 'next-auth'
import KakaoProvider from 'next-auth/providers/kakao'
import NaverProvider from 'next-auth/providers/naver'
import GoogleProvider from 'next-auth/providers/google'

export const authOptions = {
  providers: [
    KakaoProvider({
      clientId: process.env.KAKAO_CLIENT_ID ?? '',
      clientSecret: process.env.KAKAO_CLIENT_SECRET ?? '',
    }),
    NaverProvider({
      clientId: process.env.NAVER_CLIENT_ID ?? '',
      clientSecret: process.env.NAVER_CLIENT_SECRET ?? '',
    }),
    GoogleProvider({
      clientId: process.env.KAKAO_CLIENT_ID ?? '',
      clientSecret: process.env.KAKAO_CLIENT_SECRET ?? '',
    }),
  ],
}

const handler = NextAuth(authOptions)

export { handler as GET, handler as POST }
```

.env

```ts
KAKAO_CLIENT_ID = '~~~~~~~~~~~~'
KAKAO_CLIENT_SECRET = '~~~~~~~~~~~~'

NAVER_CLIENT_ID = '~~~~~~~~~~~~'
NAVER_CLIENT_SECRET = '~~~~~~~~~~~~'

GOOGLE_CLIENT_ID = '~~~~~~~~~~~~'
GOOGLE_CLIENT_SECRET = '~~~~~~~~~~~~'
```

4. Session Provider

components/providers/session-providers.tsx

```tsx
'use client'

import { SessionProvider } from 'next-auth/react'
import { ReactNode } from 'react'
import { Session } from 'next-auth'

type Props = {
  session?: Session | null
  children: ReactNode
}

export default function AuthSession({ session, children }: Props) {
  return <SessionProvider session={session}>{children}</SessionProvider>
}
```

5. layout.tsx

```tsx
import type { Metadata } from 'next'
import { Inter } from 'next/font/google'
import './globals.css'
import AuthSession from '@/components/providers/session-provider'
import Header from '@/components/Header'
import RecoilRootProvider from '@/components/providers/recoilRootProvider'

const inter = Inter({ subsets: ['latin'] })

export const metadata: Metadata = {
  title: 'Create Next App',
  description: 'Generated by create next app',
}

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode
}>) {
  return (
    <html lang="en">
      <body className={inter.className}>
        <RecoilRootProvider>
          <Header />
          <AuthSession>{children}</AuthSession>
        </RecoilRootProvider>
      </body>
    </html>
  )
}
```

우선 기본적인 세팅은 끝났습니다. 저는 상태관리 라이브러리 Recoil를 사용하여 헤더컴포넌트에 간단하게 로그인에 대한 여부처리를 간단하게 분기처리를 해두었습니다.

로그인이 되면 실제 네이버, 카카오 에 사용되는 닉네임,사진을 가져오게 구성을 했습니다. 그러면 우선 로그인을 적용하는 페이지에 대한 코드를 한번 보겠습니다.

6. page.tsx

```tsx
'use client'

import { signIn, signOut, useSession } from 'next-auth/react'
import { useRecoilState } from 'recoil'
import { sessionState } from './states/sesionState'
import { useEffect } from 'react'

export default function Home() {
  const { data: session } = useSession()

  const [, setSession] = useRecoilState(sessionState)

  // NextAuth 세션 정보가 변경될 때마다 Recoil 상태 업데이트
  useEffect(() => {
    setSession(session)
  }, [session, setSession])

  return (
    <main className="flex min-h-screen flex-col items-center justify-between p-24">
      <div className="z-10 w-full max-w-5xl items-center justify-between font-mono text-sm lg:flex">
        <button onClick={() => signIn()}>Sign In</button>

        <button onClick={() => signOut()}>Sign Out</button>
      </div>
    </main>
  )
}
```

<Image
  src="/blogs/nextjs-auth/localscreen.png"
  width="1000"
  height="600"
  alt="Image"
  sizes="100vw"
/>

최초 localhost:3000 에 보여지는 화면입니다. 이제 로그인 버튼을 누르면 페이지가 이동되어집니다.

NextAUth.js 에서 SignIn 함수를 사용할 때 페이지가 http://localhost:3000/api/auth/signin 로 리디렉션 되는걸 볼수있습니다.

여기서 보여지는 소셜 로그인 3개는 이전 api/[...nextauth]/route.ts 에 작성된 provider에 제공된 카카오,네이버,구글이 보여집니다.

저는 추가적으로 api/[...nextauth]/route.ts 작성된 코드에서 authOptions에 page 옵션을 적용은 안했지만, 알고있으면 굉장히 좋은 옵션인거같아 정리를 하겠습니다.

```ts
export const authOptions = {
  providers: [
    // 인증 제공자 설정
  ],
  pages: {
    signIn: '/auth/signin',
    signOut: '/auth/signout',
    error: '/auth/error',
    verifyRequest: '/auth/verify-request',
    // newUser: '/auth/new-user'
  },
}
```

- signIn : 사용자가 로그인할 때 사용되는 페이지입니다. URL은 위에 작성된 url로 적용을 할수 있습니다. /api/auth/signin

- signOut : 사용자가 로그아웃할 때 사용되는 페이지입니다.URL은 위에 작성된 url로 적용을 할수 있습니다.

- error : 인증 과정에서 오류가 발생했을 때 표시되는 페이지입니다. URL은 위에 작성된 url로 적용을 할수 있습니다.

- verifyRequest : 이메일 인증(또는 비밀번호 재설정 요청등)을 한 후 사용자에게 보여주는 페이지 입니다. URL은 위에 작성된 url로 적용을 할수 있습니다.

- newUser : (선택적) 새로운 사용자가 처음 로그인했을 때 리디렉션 되는 페이지 입니다. 이는 사용자에게 추가 정보를 입력 받거나, 환영메시지를 보여주는데 주로 사용됩니다.URL은 위에 작성된 url로 적용을 할수 있습니다.

<Image
  src="/blogs/nextjs-auth/snspage.png"
  width="1000"
  height="600"
  alt="Image"
  sizes="100vw"
/>

자 그러면 이제 우리가 provider에 적용한 네이버, 카카오 버튼을 눌러보겠습니다.

<Image
  src="/blogs/nextjs-auth/naver로그인.png"
  width="1000"
  height="600"
  alt="Image"
  sizes="100vw"
/>

<Image
  src="/blogs/nextjs-auth/카카오로그인.png"
  width="1000"
  height="600"
  alt="Image"
  sizes="100vw"
/>

1. 카카오 OAuth API [카카오 개발자도구](https://developers.kakao.com/)

- 내 애플리케이션 > 제품 설정 > 카카오 로그인

- Redirect URI를 연결해주자! 다른 소셜로그인도 마찬가지로 리다이렉트 URI를 연결하지 않으면 에러가 발생한다.

"http://localhost:3000/api/auth/callback/kakao"

- 만약 배포 후 도메인이 생긴다면 그때 다시 변경해주자!

- 내 애플리케이션 > 제품설정 > 카카오 로그인 에서 활성화 설정을 ON으로 한다.

1. 네이버 - OAuth API [네이버 개발자도구](https://developers.naver.com/main/)

- 회원가입 후에 애플리케이션을 등록해주면 된다. 이름과 사용할 API를 선택하면 된다. 필수값으로 사용할 것들을 체크!

그리고 환경추가에서 이제 사용할 주소를 입력해주자! 개발상태기때문에 로컬 주소를 입력해주었다.

"http://localhost:3000/api/auth/callback/naver"

- Callback URL도 naver는 이렇게 입력해주어야한다. 사용하는 로컬포트 또는 도메인을 입력해주어야 한다.

위와 같은 작업이 끝나야지만 저런 소셜 로그인 페이지를 보실수있습니다.

## 2.로그인 완료

```tsx
'use client'

import { sessionState } from '@/app/states/sesionState'
import { useRecoilValue } from 'recoil'

export default function Header() {
  const userData = useRecoilValue(sessionState)

  return (
    <div className="flex flex-col items-center justify-center ">
      {userData ? (
        <>
          <div>로그인 상태: {userData?.user?.name}</div>
          <div>
            로그인된 사용자의 이미지:
            <img src={userData?.user?.image as string} alt="User Image" />
          </div>
        </>
      ) : (
        <div>로그인되지 않음</div>
      )}
    </div>
  )
}
```

<Image
  src="/blogs/nextjs-auth/login-com.png"
  width="1000"
  height="600"
  alt="Image"
  sizes="100vw"
/>

## 3.커스텀 버튼

```tsx
'use client'

import { signIn, signOut, useSession } from 'next-auth/react'
import { useRecoilState } from 'recoil'
import { sessionState } from './states/sesionState'
import { useEffect } from 'react'

export default function Home() {
  const { data: session } = useSession()

  const [, setSession] = useRecoilState(sessionState)

  // NextAuth 세션 정보가 변경될 때마다 Recoil 상태 업데이트
  useEffect(() => {
    setSession(session)
  }, [session, setSession])

  return (
    <main className="flex min-h-screen flex-col items-center justify-between p-24">
      <div className="z-10 w-full max-w-5xl items-center justify-between font-mono text-sm lg:flex">
        <button onClick={() => signIn()}>Sign In</button>
        <button onClick={() => signIn('kakao')}>Login with Kakao</button>
        <button onClick={() => signIn('naver')}>Login with Naver</button>
        <button onClick={() => signIn('google')}>Login with Google</button>

        <button onClick={() => signOut()}>Sign Out</button>
      </div>
    </main>
  )
}
```

######## 2월 21일 블로그 마무리 작성 예정 #######
